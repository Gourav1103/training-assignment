[
    {
      "operation": "shift",
      "spec": {
        "products": {
          "*": {
            "id": {
              "1001": {
                "@2": "products[]"
              },
              "*": {
                "@2": "products[&3].product[]"
              }
            }
          }
        }
      }
    },
    {
      "operation": "modify-overwrite-beta",
      "spec": {
        "products": {
          "*": {
            "product": {
              "*": {
                "totals": "=divide(1,2)",
                "price": "=divide(@(1,price),@(1,totals))"
              }
            }
          }
        }
      }
    },
    {
      "operation": "remove",
      "spec": {
        "products": {
          "*": {
            "product": {
              "*": {
                "totals": ""
              }
            }
          }
        }
      }
    }, {
      "operation": "shift",
      "spec": {
        "products": {
          "*": {
            "*": "products[&1].&",
            "product": {
              "*": {
                "*": "products[&3].&"
              }
            }
          }
        }
      }
    }
  ]